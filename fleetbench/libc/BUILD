cc_library(
    name = "utils",
    srcs = ["utils.cc"],
    hdrs = ["utils.h"],
    deps = [
        "@com_google_absl//absl/log:check",
        "@com_google_absl//absl/random",
    ],
)

cc_library(
    name = "memory_size_distributions",
    srcs = ["memory_size_distributions.cc"],
    hdrs = ["memory_size_distributions.h"],
    textual_hdrs = [
        "distributions/MemcpyGoogleA.csv",
        "distributions/MemcpyGoogleB.csv",
        "distributions/MemcpyGoogleD.csv",
        "distributions/MemcpyGoogleL.csv",
        "distributions/MemcpyGoogleM.csv",
        "distributions/MemcpyGoogleQ.csv",
        "distributions/MemcpyGoogleS.csv",
        "distributions/MemcpyGoogleU.csv",
        "distributions/MemcpyGoogleW.csv",
        "distributions/MemmoveGoogleA.csv",
        "distributions/MemmoveGoogleB.csv",
        "distributions/MemmoveGoogleD.csv",
        "distributions/MemmoveGoogleL.csv",
        "distributions/MemmoveGoogleM.csv",
        "distributions/MemmoveGoogleQ.csv",
        "distributions/MemmoveGoogleS.csv",
        "distributions/MemmoveGoogleU.csv",
        "distributions/MemmoveGoogleW.csv",
        "distributions/MemsetGoogleA.csv",
        "distributions/MemsetGoogleB.csv",
        "distributions/MemsetGoogleD.csv",
        "distributions/MemsetGoogleL.csv",
        "distributions/MemsetGoogleM.csv",
        "distributions/MemsetGoogleQ.csv",
        "distributions/MemsetGoogleS.csv",
        "distributions/MemsetGoogleU.csv",
        "distributions/MemsetGoogleW.csv",
        "distributions/MemcmpGoogleA.csv",
        "distributions/MemcmpGoogleB.csv",
        "distributions/MemcmpGoogleD.csv",
        "distributions/MemcmpGoogleL.csv",
        "distributions/MemcmpGoogleM.csv",
        "distributions/MemcmpGoogleQ.csv",
        "distributions/MemcmpGoogleS.csv",
        "distributions/MemcmpGoogleU.csv",
        "distributions/MemcmpGoogleW.csv",
        "distributions/BcmpGoogleA.csv",
        "distributions/BcmpGoogleB.csv",
        "distributions/BcmpGoogleD.csv",
        "distributions/BcmpGoogleL.csv",
        "distributions/BcmpGoogleM.csv",
        "distributions/BcmpGoogleQ.csv",
        "distributions/BcmpGoogleS.csv",
        "distributions/BcmpGoogleU.csv",
        "distributions/BcmpGoogleW.csv",
    ],
    deps = [
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/types:span",
    ],
)

cc_test(
    name = "mem_benchmark",
    srcs = ["mem_benchmark.cc"],
    linkstatic = 1,
    malloc = "@com_google_tcmalloc//tcmalloc",
    deps = [
        ":memory_size_distributions",
        ":utils",
        "//fleetbench:benchmark_main",
        "//fleetbench/common",
        "@com_google_absl//absl/log:check",
        "@com_google_absl//absl/random:distributions",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/types:span",
        "@com_google_benchmark//:benchmark",
    ],
)
